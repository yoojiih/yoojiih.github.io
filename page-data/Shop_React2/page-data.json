{"componentChunkName":"component---src-templates-blog-template-js","path":"/Shop_React2/","result":{"data":{"cur":{"id":"b1038b2d-2d63-564e-808e-83b5c081b223","html":"<h1 id=\"client-server-간-통신\" style=\"position:relative;\"><a href=\"#client-server-%EA%B0%84-%ED%86%B5%EC%8B%A0\" aria-label=\"client server 간 통신 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Client, Server 간 통신</h1>\n<ul>\n<li>Client인 browser 측에서 정보 입력하면 서버측에서 받아서 처리하는 형식</li>\n<li>\n<p>이 정보들을 받기 위해선 Body-parser라는 Dependency가 필요\n<code class=\"language-text\">npm i body-parser</code></p>\n<h2 id=\"회원가입을-위한-route-생성-serverindexjs\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85%EC%9D%84-%EC%9C%84%ED%95%9C-route-%EC%83%9D%EC%84%B1-serverindexjs\" aria-label=\"회원가입을 위한 route 생성 serverindexjs permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입을 위한 Route 생성 (server/index.js)</h2>\n<p>Register Router</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> User <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./models/User\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// bodyParser 가져옴</span>\n<span class=\"token keyword\">const</span> bodyParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'body-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<p>//----- body parser option-------\n// client에서 오는 정보(application/x-www-form-urlencoded 이렇게 된 데이터)를 서버에서 분석해서 가져올 수 있게 해주는 것\napp.use(bodyParser.urlencoded({ extended: true }));\n//application/json 타입으로 된 걸 분석해서 가져올 수 있게 함\napp.use(bodyParser.json());\n//-------------------------------</p>\n<p>// post 메소드를 이용하며 라우터의 end point는 register, callback function을  (req, res) => 넣어줌\n// <a href=\"http://localhost:5000/register\">http://localhost:5000/register</a>\napp.post(‘/api/users/register’, (req, res) => {</p>\n<p>  // 정보들을 db에 넣기 위해서 request.body 작성</p>\n<p>  // User: client에서 가져온 회원 가입 할떄 필요한 정보들을 데이터 베이스에 넣어주기 위해 User model을 가져옴\n//const user: 이걸 이용해 user 인스턴스 생성\n// (req.body): bodyparser를 이용해 받아온 json 형식으로 된 {id: \"\", password:\"\"} client측 정보 들어가있음\nconst user = new User(req.body)\n// save: mongo db 메소드 => req.body의 정보들이 user model에 저장됨\nuser.save((err, userInfo) => {\n// 저장 시\n// 에러가 있다면 client에다가 json 형식으로 에러가 있다고 에러 메시지와 함께 전달\nif (err) return res.json({ success: false, err })\n// 성공한다면 client에다가 user info를 client에다가 성공했다는 표시인 status(200)을 json형식으로 success: true라는 정보를 전달\nreturn res.status(200).json({\nsuccess: true\n})\n})\n})</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># NODE MON (개발모드 즉, 로컬에서만 사용)\nnode server를 실행 후 소스 변경 시 변화를 감지해서 자동으로 서버 재시작해주는 tool \n번거롭게 굳이 서버를 올리고 내리고 하지 않아도 변화된 부분을 반영시켜줌\n`npm i nodemon --save -dev`\n시작할 때 nodemon으로 시작하기 위해 package.json에 스크립트 추가\n`\"backend\": \"nodemon server/index.js\",`\n이후 `npm run backend`로 실행\n\n\n# 비밀정보 보호\n소스 코드 내 비밀정보 보호를 위해 비밀정보를 다른 파일로 빼서 .gitignore 파일에 추가\n- 개발환경을 로컬모드, 배포모드로 구분\n  환경변수 process.env.NODE_ENV\n  Local 환경: development\n  Deploy(배포): production  -> 클라우드 서비스(aws)를 통해 배포 한 후 개발용\n\ndevelopment 모드에 있을 땐 process.env.NODE_ENV (환경변수)가 development라고 나오고 \ndeploy한 이후면 production이라고 뜸 \n```javascript\nif(process.env.NODE_ENV === 'production') {\n    module.exports = require('./prod');\n} else {\n  // development라면 module.exports를 prod에서 하는게 아니라 dev.js 파일에서 함\n    module.exports = require('./dev');\n}</code></pre></div>\n<p>development 모드에서 하면 dev.js에서 <code class=\"language-text\">mongoURI</code> 가져옴\nproduction이면 prod.js에다가 MONGO_URI적어줌(aws에 작성한 것과 동일해야함)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    mongoURI<span class=\"token operator\">:</span> process<span class=\"token punctuation\">.</span>env<span class=\"token punctuation\">.</span><span class=\"token constant\">MONGO_URI</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>server/index.js에다가는 config.mongoURI 넣어줌</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> config <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./config/key'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nmongoose<span class=\"token punctuation\">.</span><span class=\"token function\">connect</span><span class=\"token punctuation\">(</span>config<span class=\"token punctuation\">.</span>mongoURI<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span> </code></pre></div>","excerpt":"Client, Server 간 통신 Client인 browser 측에서 정보 입력하면 서버측에서 받아서 처리하는 형식 이 정보들을 받기 위해선 Body-parser라는 Dependency가 필요\n 회원가입을 위한 Route 생성 (server/index.js) Register Router //----- body parser option-------\n// client에서 오는 정보(application/x-www-form-urlencoded 이렇게 된 데이터)를 서버에서 분석해서 가져올 수 있게 해주는 것\napp.use(bodyParser.urlencoded({ extended: true }));\n//application/json 타입으로 된 걸 분석해서 가져올 수 있게 함\napp.use(bodyParser.json());\n//------------------------------- // post 메소드를 이용하며 라우터의 end point는 register, callback fun…","frontmatter":{"date":"December 02, 2021","title":"Shop Project_React","categories":"TIL","author":"yooji","emoji":null},"fields":{"slug":"/Shop_React2/"}},"next":{"id":"f1ffc20d-507b-50ab-8452-dacf17aef84b","html":"<h1 id=\"project명-무제-_-개인-프로젝트\" style=\"position:relative;\"><a href=\"#project%EB%AA%85-%EB%AC%B4%EC%A0%9C-_-%EA%B0%9C%EC%9D%B8-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8\" aria-label=\"project명 무제 _ 개인 프로젝트 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Project명 (무제) _ 개인 프로젝트</h1>\n<ul>\n<li>\n<h3 id=\"목표\" style=\"position:relative;\"><a href=\"#%EB%AA%A9%ED%91%9C\" aria-label=\"목표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>목표</h3>\n<p>Front-end 뿐만 아니라 백 서버와 DB를 구축해서 어느 서비스에나 존재하는\n로그인, 회원가입과 더불어 상품들을 관리하는 쇼핑몰 프로젝트를 진행하고자 한다\n추가적으로 완성한 프로젝트를 aws로 배포해보고자 한다</p>\n</li>\n<li>\n<h3 id=\"프로젝트-예상-기간-2021년-12월-01일--2021년-12월-16일\" style=\"position:relative;\"><a href=\"#%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EC%98%88%EC%83%81-%EA%B8%B0%EA%B0%84-2021%EB%85%84-12%EC%9B%94-01%EC%9D%BC--2021%EB%85%84-12%EC%9B%94-16%EC%9D%BC\" aria-label=\"프로젝트 예상 기간 2021년 12월 01일  2021년 12월 16일 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>프로젝트 예상 기간 (2021년 12월 01일 ~ 2021년 12월 16일)</h3>\n</li>\n</ul>\n<h1 id=\"스택\" style=\"position:relative;\"><a href=\"#%EC%8A%A4%ED%83%9D\" aria-label=\"스택 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>스택</h1>\n<ul>\n<li>\n<h2 id=\"front-end\" style=\"position:relative;\"><a href=\"#front-end\" aria-label=\"front end permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Front-end</h2>\n<blockquote>\n<p>React\nRedux\nJavascript\nTailwind</p>\n</blockquote>\n</li>\n<li>\n<h2 id=\"back-end\" style=\"position:relative;\"><a href=\"#back-end\" aria-label=\"back end permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Back-end</h2>\n<blockquote>\n<p>node js\nexpress</p>\n</blockquote>\n</li>\n<li>\n<h2 id=\"db\" style=\"position:relative;\"><a href=\"#db\" aria-label=\"db permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>DB</h2>\n<blockquote>\n<p>mongo DB</p>\n</blockquote>\n</li>\n<li>\n<h2 id=\"배포\" style=\"position:relative;\"><a href=\"#%EB%B0%B0%ED%8F%AC\" aria-label=\"배포 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>배포</h2>\n<blockquote>\n<p>aws</p>\n</blockquote>\n</li>\n</ul>\n<h1 id=\"구현-순서\" style=\"position:relative;\"><a href=\"#%EA%B5%AC%ED%98%84-%EC%88%9C%EC%84%9C\" aria-label=\"구현 순서 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>구현 순서</h1>\n<ol>\n<li>모델 설계</li>\n<li>백엔드 로직 구현</li>\n<li>프론트 구현</li>\n<li>Redux로 상태관리</li>\n<li>배포 </li>\n</ol>","frontmatter":{"date":"December 01, 2021","title":"Shop Project_React","categories":"블로그","author":"yooji","emoji":null},"fields":{"slug":"/Shop_React0/"}},"prev":{"id":"01749ce1-54ad-54e8-bc6e-3fdf2fee76d2","html":"<h1 id=\"회원가입-기능-backend\" style=\"position:relative;\"><a href=\"#%ED%9A%8C%EC%9B%90%EA%B0%80%EC%9E%85-%EA%B8%B0%EB%8A%A5-backend\" aria-label=\"회원가입 기능 backend permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회원가입 기능 (Backend)</h1>\n<h2 id=\"bcrypt로-비밀번호-암호화\" style=\"position:relative;\"><a href=\"#bcrypt%EB%A1%9C-%EB%B9%84%EB%B0%80%EB%B2%88%ED%98%B8-%EC%95%94%ED%98%B8%ED%99%94\" aria-label=\"bcrypt로 비밀번호 암호화 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Bcrypt로 비밀번호 암호화</h2>\n<p><a href=\"https://www.npmjs.com/package/bcrypt\">공식문서 참고</a></p>\n<ul>\n<li>DB에 저장 시 Bcrypt라는 라이브러리 사용해 비밀번호를 암호화해 관리자도 암호를 모르게 하는게 목표\n<code class=\"language-text\">npm i bcrypt</code></li>\n<li>\n<p>Bcrypt로 비밀번호 암호화 하는 과정</p>\n<ol>\n<li>Register Router(server/index.js)에서 유저 정보들(Account, Password 등)을 데이터베이스(user model인 userSchema)에 저장(user.save)하기 전\n암호화하기 위해 server/models/User.js에서 유저 스키마를 가져와서 mongoose 메소드인 pre를 사용</li>\n<li>function 내 작업 끝나면 다시 user.save로 돌아가게끔 파라미터로 next를 넣어 next() function으로 user.save로 보냄</li>\n<li>비밀번호를 암호화 시키기 위해서 다운받은 bcrypt를 가져옴</li>\n<li>To hash a password\n-> salt가 몇글자인지 나타내는 saltRounds를 먼저 지정 후 salt를 생성함 -> 솔트를 이용해 비밀번호를 암호화 시킴</li>\n<li>\n<p>비밀번호 암호화를 userSchema 모델안의 필드 중 password가 변환될 때에만 해줌\n유저정보를 변경해 저장할 때마다 userSchema.pre쪽을 계속 바꾸게 되어 이메일만 변경해도 비밀번호를 암호화해버리는 문제가 발생하기 때문에\n비밀번호 바꿀때만 실행해야하게 조건(if (user.isModified(‘password’)) {) 달아줌\n( server/models/User.js )</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> bcrypt <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'bcrypt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> saltRounds <span class=\"token operator\">=</span> <span class=\"token number\">10</span>\n<span class=\"token operator\">...</span>\nuserSchema<span class=\"token punctuation\">.</span><span class=\"token function\">pre</span><span class=\"token punctuation\">(</span><span class=\"token string\">'save'</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">next</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n<span class=\"token keyword\">var</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ol>\n<p>if (user.isModified(‘password’)) {</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// 비밀번호 암호화\n// bcrypt를 가져와서 salt를 만들 때 saltRounds과 callback function을 넣어줌\nbcrypt.genSalt(saltRounds, function (err, salt) {\n    // 에러나면 err를 가져와서 리턴시켜 user.save로 돌아가고\n    if (err) return next(err)\n    // salt를 제대로 생성했다면 다시 bcrypt가져와 암호화 되지 않은 비밀번호와 salt를 이용해서 해시에 넣어줌\n    // 암호화 되지 않은 비밀번호는 const user = new User(req.body)이렇게 req.body를 User모델에 넣었기 때문에\n    // var user = this;를 이용해 userSchema의 password를 user.password로 가져옴\n    // callback function으로 err와 암호화된 비밀번호인 hash를 넣어줌   \n    bcrypt.hash(user.password, salt, function (err, hash) {\n       // 에러 발생시 err를 리턴\n        if (err) return next(err)\n        // hash(암호화된 비밀번호)를 만드는 데 성공했다면 user.password(암호화 되지 않은 비밀번호)를 hash된 비밀번호로 교체해주고 \n        user.password = hash\n        // next()를 이용해서 user.save로 돌아감\n        next()\n    })\n})</code></pre></div>\n<p>} else {\n//비밀번호 바꾸는게 아닌 다른걸 바꾸면 그냥 next()를 해줘서 여기서 머물지 않고 바로 save쪽으로 넘어가게 해줌\nnext()\n}\n})</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(server/index.js) \n```js\n//user에 관한 api를 생성  -> express에서 제공되는 router를 이용\napp.post('/api/users/register', (req, res) => {\n\nconst user = new User(req.body)\n------------저장하기 전-----------------\nuser.save((err, userInfo) => {\nif (err) return res.json({ success: false, err })\nreturn res.status(200).json({\n  success: true\n})\n})\n})</code></pre></div>\n<h1 id=\"로그인-기능\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8-%EA%B8%B0%EB%8A%A5\" aria-label=\"로그인 기능 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로그인 기능</h1>\n<h2 id=\"로그인-router-생성\" style=\"position:relative;\"><a href=\"#%EB%A1%9C%EA%B7%B8%EC%9D%B8-router-%EC%83%9D%EC%84%B1\" aria-label=\"로그인 router 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>로그인 Router 생성</h2>\n</li>\n<li>post method 사용</li>\n<li>end point는 /login</li>\n<li>request, response 받음</li>\n<li>요청된 이메일(브라우저에 입력한 이메일)을 데이터베이스에 있는지 찾음</li>\n<li>요청된 이메일이 데이터 베이스에 있다면 비밀번호가 같은지 확인</li>\n<li>\n<p>비밀번호 까지 맞다면 그 유저를 위한 토큰을 생성</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">app<span class=\"token punctuation\">.</span><span class=\"token function\">post</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/api/users/login'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">req<span class=\"token punctuation\">,</span> res</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token comment\">// 요청된 이메일(브라우저에 입력한 이메일)을 데이터베이스에 있는지 찾음</span>\n<span class=\"token comment\">// 유저 모델을 가져와서 mongoDB에서 제공하는 method인 findOne으로 찾고자 하는 이메일을 넣어 찾음</span>\n<span class=\"token comment\">// err, user로 callback function을 줌  </span>\nUser<span class=\"token punctuation\">.</span><span class=\"token function\">findOne</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> email<span class=\"token operator\">:</span> req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>email <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> user</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n<span class=\"token comment\">// User collection 안에 해당 이메일을 가진 유저가 한명도 없다면(!user) </span>\n<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>user<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// return을 해줄 때 response json 데이터로 loginSuccess: false와 message를 줌</span>\n  <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    loginSuccess<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    message<span class=\"token operator\">:</span> <span class=\"token string\">\"제공된 이메일에 해당하는 유저가 없습니다.\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 요청된 이메일이 데이터 베이스에 있다면 (user collection 안에 해당 이메일을 가진 유저가 있다면) 비밀번호가 같은지 확인</span>\n<span class=\"token comment\">// user안에는 유저의 이름, 비밀번호, 이메일이 들어있는데 여기서 comparePassword 메소드를 생성해 (작명 아무렇게나 가능)</span>\n<span class=\"token comment\">// req.body.password(암호화 되기 전 비밀번호)와 callback function으로 두가지 인자(argument)를 넣음</span>\n<span class=\"token comment\">// 에러가 나면 err, 비밀번호를 비교해서 브라우저에서 입력한 비밀번호와 db내 비밀번호를 비교해 일치 시 isMatch로 맞는지 가져오는 메소드를 유저 모델에서 만듦</span>\nuser<span class=\"token punctuation\">.</span><span class=\"token function\">comparePassword</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span>body<span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> isMatch</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\n  <span class=\"token comment\">// isMatch가 없으면 비밀번호가 틀렸다는 뜻이기 때문에 response를 client에다가 loginSuccess: false, message를 줌</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>isMatch<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> loginSuccess<span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> message<span class=\"token operator\">:</span> <span class=\"token string\">\"비밀번호가 틀렸습니다.\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>(server/models/User.js)</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// userSchema를 가져온 다음에 comparePassword function에 plainPassword, cb 을 준다음</span>\nuserSchema<span class=\"token punctuation\">.</span>methods<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">comparePassword</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">plainPassword<span class=\"token punctuation\">,</span> cb</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token comment\">// plainPassword 와 db에 있는 암호회된 비밀번호가 같은지 체크하려면 plainPassword를 암호화 해서 비교하면 됨</span>\n<span class=\"token comment\">// bcrypt를 가져와서 compare(plainPassword, 암호화된 비밀번호를 가져오기 위해 userSchema에서 password를 가져옴, callback function  )</span>\nbcrypt<span class=\"token punctuation\">.</span><span class=\"token function\">compare</span><span class=\"token punctuation\">(</span>plainPassword<span class=\"token punctuation\">,</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>password<span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">err<span class=\"token punctuation\">,</span> isMatch</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// 비밀번호가 다르면 callback error를 줌</span>\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span> <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  \n    <span class=\"token comment\">// 같다면 cb을 줄때 에러는 없고(null) 비밀번호가 같음(true)을 넘겨줌</span>\n    <span class=\"token function\">cb</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">,</span> isMatch<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token comment\">// 다시 로그인 라우터 쪽의  user.comparePassword(req.body.password, (err, isMatch) => { 로 가서 comparePassword 실행</span></code></pre></div>\n</li>\n</ul>\n<h2 id=\"토큰-생성-jsonwebtoken\" style=\"position:relative;\"><a href=\"#%ED%86%A0%ED%81%B0-%EC%83%9D%EC%84%B1-jsonwebtoken\" aria-label=\"토큰 생성 jsonwebtoken permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>토큰 생성 (jsonwebtoken)</h2>\n<p><a href=\"https://www.npmjs.com/package/jsonwebtoken\">공식문서 참고</a></p>\n<ul>\n<li>토큰 생성을 위해 라이브러리 설치\n<code class=\"language-text\">npm i jsonwebtoken</code>\njsonwebtoken을 import 해와서 sign이라는 메소드 이용해서 합쳐주면 토큰 생성됨</li>\n<li>\n<p>쿠키 사용을 위한 express에서 제공하는 라이브러리 설치\n<code class=\"language-text\">npm i cookie-parser</code></p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token comment\">// cookie parser 사용하기 위한 작업</span>\n<span class=\"token keyword\">const</span> cookieParser <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'cookie-parser'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\napp<span class=\"token punctuation\">.</span><span class=\"token function\">use</span><span class=\"token punctuation\">(</span><span class=\"token function\">cookieParser</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n</ul>\n<p>app.post(‘/api/users/login’, (req, res) => {\n// … 요청된 이메일이 데이터 베이스에 있다면 (user collection 안에 해당 이메일을 가진 유저가 있다면) 비밀번호가 같은지 확인</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">  // 비밀번호가 맞다면 그 유저를 위한 토큰을 생성\n  // 토큰 생성 시 위에서 따로 comparePassword 메소드 생성한 것처럼 generateToken을 생성\n  // callback function 파라미터에 하나만 들어있음 function (cb) \n  user.generateToken((err, user) => {\n    // 에러가 있다면 res.status(400)을 클라이언트에 전해주고 err메시지도 같이 전달해줌\n    if (err) return res.status(400).send(err);\n    // User.js에서 var token = jwt.sign(user._id.toHexString(), 'secretToken')이렇게 토큰을 생성한 다음에 user.token에다가 넣어준 걸 받아온 상태 (user)\n    // 이 user안에 토큰이 들어있는데 이걸 쿠키 or 로컳스토리지 or session 저장을 해서 보관해야됨\n    // 이 중에 어디에 저장해야 가장 안전할까에 대한 논란이 많음 각기 장단점이 존재\n    // 쿠키에다 저장 시 토큰 저장을 user.token을 아무 이름(x_auth)으로 지정\n    res.cookie(\"w_auth\", user.token)\n      //.status(200)는 성공했다는 표시\n      .status(200)\n      // json으로 데이터(loginSuccess와 userId) 보내줌 \n      .json({ loginSuccess: true, userId: user._id })\n  })\n})</code></pre></div>\n<p>  })\n})</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(server/models/User.js)\n```js\n//jsonwebtoken을 import 해옴\nconst jwt = require('jsonwebtoken');\n\nuserSchema.methods.generateToken = function (cb) {\n    var user = this;\n    \n    // jsonwebtoken(jwt의 sign 메소드)을 이용해서 db내 user id와 secretToken(아무거나)를 합쳐 token을 생성함\n    // user._id + 'secretToken' = token\n    // 나중에 token 해석 시 secretToken를 넣으면 user._id가 나오게 되기 때문에 이 사람이 누구인지 알 수 있음\n    // user._id를 plain object로 변환시키기 위해 toHexString()사용해야 에러 발생하지 않음\n    var token = jwt.sign(user._id.toHexString(), 'secretToken')\n    // 생성한 token을 userSchema에 있는 token 필드에 넣어줌\n    user.token = token\n    user.save(function (err, user) {\n      // 에러 있다면 리턴 시 callback으로 err를 전달해주고\n        if (err) return cb(err)\n        // save 성공 시 err는 없고(null) user정보만 user.generateToken((err, user) => { 로 다시 전달해줌\n        cb(null, user)\n    })\n}</code></pre></div>\n<p>Reference</p>\n<p><a href=\"https://www.npmjs.com/package/jsonwebtoken\">jsonwebtoken공식문서</a>\n<a href=\"https://velog.io/@kihyun/React-Hook-Form-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\">kihyun님 블로그</a></p>","frontmatter":{"date":"December 03, 2021","title":"Shop Project_React","categories":"TIL","author":"yooji","emoji":null},"fields":{"slug":"/Shop_React3/"}},"site":{"siteMetadata":{"siteUrl":"https://www.yoojiih.github.io","comments":{"utterances":{"repo":"yoojiih/yoojiih.github.io"}}}}},"pageContext":{"slug":"/Shop_React2/","nextSlug":"/Shop_React0/","prevSlug":"/Shop_React3/"}},"staticQueryHashes":["1073350324","2938748437"]}